<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teacher Management</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #f4f4f4; }
  input, select, button { padding: 6px; margin: 4px 0; width: 100%; box-sizing: border-box; }
  .form-group { margin-bottom: 12px; }
  .flex-row { display: flex; gap: 12px; }
  .flex-row > * { flex: 1; }
  .btn { cursor: pointer; background: #007bff; color: white; border: none; }
  .btn:hover { background: #0056b3; }
  .btn-danger { background: #dc3545; }
  .btn-danger:hover { background: #a71d2a; }
</style>
</head>
<body>
<h1>Teacher Management</h1>

<div id="form-container">
  <h3 id="form-title">Add New Teacher</h3>
  <div class="form-group">
    <label for="name">Name:</label>
    <input id="name" type="text" placeholder="Teacher's full name" />
  </div>
  <div class="form-group">
    <label for="classes">Classes (comma separated):</label>
    <input id="classes" type="text" placeholder="e.g. Nursery, ABC, K1, Grade 1" />
  </div>
  <div class="form-group">
    <label for="status">Status:</label>
    <select id="status">
      <option value="Active">Active</option>
      <option value="Inactive">Inactive</option>
    </select>
  </div>
  <button id="submitBtn" class="btn">Add Teacher</button>
  <button id="cancelBtn" class="btn" style="display:none; background:#6c757d;">Cancel</button>
</div>

<table>
  <thead>
    <tr>
      <th>Teacher ID</th>
      <th>Name</th>
      <th>Classes</th>
      <th>PIN</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="teacherTableBody">
    <!-- Teacher rows will appear here -->
  </tbody>
</table>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbw9P_XOd4k498l0e4WDbFqAF1asb2u4sRj_uX2B-2S1MvyWOeWQZqxy8dr13mPOdNOeuw/exec";

  let editTeacherId = null;

  async function fetchTeachers() {
    try {
      const res = await fetch(`${API_URL}?action=getTeacherList`);
      const data = await res.json();
      if(data.success) {
        populateTeacherTable(data.teachers);
      } else {
        alert("Error fetching teachers: " + data.message);
      }
    } catch (err) {
      alert("Failed to fetch teachers: " + err.message);
    }
  }

  function populateTeacherTable(teachers) {
    const tbody = document.getElementById("teacherTableBody");
    tbody.innerHTML = "";
    teachers.forEach(t => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${t.teacherId}</td>
        <td>${t.name}</td>
        <td>${t.classes}</td>
        <td>${t.pin}</td>
        <td>${t.status}</td>
        <td>
          <button onclick="startEditTeacher('${t.teacherId}', '${escapeHtml(t.name)}', '${escapeHtml(t.classes)}', '${t.status}')" class="btn">Edit</button>
          <button onclick="deleteTeacher('${t.teacherId}')" class="btn btn-danger">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function escapeHtml(text) {
    return text.replace(/"/g, "&quot;").replace(/'/g, "&#39;");
  }

  async function addTeacher() {
    const name = document.getElementById("name").value.trim();
    const classes = document.getElementById("classes").value.trim();
    const status = document.getElementById("status").value;

    if (!name || !classes || !status) {
      alert("Please fill in all fields.");
      return;
    }

    const formData = new URLSearchParams();
    formData.append("action", "addTeacher");
    formData.append("name", name);
    formData.append("classes", classes);
    formData.append("status", status);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        alert("Teacher added successfully.");
        resetForm();
        fetchTeachers();
      } else {
        alert("Error adding teacher: " + data.message);
      }
    } catch (err) {
      alert("Failed to add teacher: " + err.message);
    }
  }

  async function editTeacher() {
    const name = document.getElementById("name").value.trim();
    const classes = document.getElementById("classes").value.trim();
    const status = document.getElementById("status").value;

    if (!editTeacherId) {
      alert("No teacher selected for editing.");
      return;
    }
    if (!name || !classes || !status) {
      alert("Please fill in all fields.");
      return;
    }

    const formData = new URLSearchParams();
    formData.append("action", "editTeacher");
    formData.append("teacherId", editTeacherId);
    formData.append("name", name);
    formData.append("classes", classes);
    formData.append("status", status);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        alert("Teacher updated successfully.");
        resetForm();
        fetchTeachers();
      } else {
        alert("Error updating teacher: " + data.message);
      }
    } catch (err) {
      alert("Failed to update teacher: " + err.message);
    }
  }

  async function deleteTeacher(teacherId) {
    if (!confirm("Are you sure you want to delete this teacher?")) return;

    const formData = new URLSearchParams();
    formData.append("action", "deleteTeacher");
    formData.append("teacherId", teacherId);

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        alert("Teacher deleted successfully.");
        fetchTeachers();
      } else {
        alert("Error deleting teacher: " + data.message);
      }
    } catch (err) {
      alert("Failed to delete teacher: " + err.message);
    }
  }

  function startEditTeacher(id, name, classes, status) {
    editTeacherId = id;
    document.getElementById("form-title").textContent = "Edit Teacher";
    document.getElementById("name").value = name;
    document.getElementById("classes").value = classes;
    document.getElementById("status").value = status;
    document.getElementById("submitBtn").textContent = "Update Teacher";
    document.getElementById("cancelBtn").style.display = "inline-block";
  }

  function resetForm() {
    editTeacherId = null;
    document.getElementById("form-title").textContent = "Add New Teacher";
    document.getElementById("name").value = "";
    document.getElementById("classes").value = "";
    document.getElementById("status").value = "Active";
    document.getElementById("submitBtn").textContent = "Add Teacher";
    document.getElementById("cancelBtn").style.display = "none";
  }

  document.getElementById("submitBtn").addEventListener("click", () => {
    if (editTeacherId) {
      editTeacher();
    } else {
      addTeacher();
    }
  });

  document.getElementById("cancelBtn").addEventListener("click", () => {
    resetForm();
  });

  // Initial load
  fetchTeachers();
</script>
</body>
</html>
