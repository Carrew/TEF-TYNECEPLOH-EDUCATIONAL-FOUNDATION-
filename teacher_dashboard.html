<!DOCTYPE html>
<html>
<head>
  <title>Teacher Dashboard - Submit Grades</title>
</head>
<body>
  <h1>Submit Grades</h1>

  <label for="studentSelect">Select Student:</label>
  <select id="studentSelect">
    <option value="">Loading students...</option>
  </select>

  <label for="subject">Subject:</label>
  <input type="text" id="subject">

  <label for="score">Score:</label>
  <input type="number" id="score" min="0" max="100">

  <label for="period">Period:</label>
  <select id="period">
    <option value="1st Period">1st Period</option>
    <option value="2nd Period">2nd Period</option>
    <option value="3rd Period">3rd Period</option>
    <option value="Exam">Exam</option>
    <option value="4th Period">4th Period</option>
    <option value="5th Period">5th Period</option>
    <option value="6th Period">6th Period</option>
    <option value="Final Exam">Final Exam</option>
  </select>

  <button onclick="submitGrade()">Submit Grade</button>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbw9P_XOd4k498l0e4WDbFqAF1asb2u4sRj_uX2B-2S1MvyWOeWQZqxy8dr13mPOdNOeuw/exec";
    let teacherId = null;

    // Load students assigned to this teacher
    function loadStudents() {
      fetch(`${scriptUrl}?action=getAssignedStudents&teacherId=${teacherId}`)
        .then(res => res.json())
        .then(data => {
          const select = document.getElementById("studentSelect");
          select.innerHTML = "";
          if (data.success && data.students.length > 0) {
            data.students.forEach(student => {
              let option = document.createElement("option");
              option.value = student.StudentID;
              option.textContent = student.Name;
              select.appendChild(option);
            });
          } else {
            let option = document.createElement("option");
            option.textContent = "No students assigned";
            select.appendChild(option);
          }
        })
        .catch(err => console.error(err));
    }

    // Submit grade
    function submitGrade() {
      const studentId = document.getElementById("studentSelect").value;
      const subject = document.getElementById("subject").value.trim();
      const score = document.getElementById("score").value.trim();
      const period = document.getElementById("period").value;

      if (!studentId || !subject || !score) {
        alert("Please fill all fields");
        return;
      }

      const formData = new FormData();
      formData.append("action", "submitGrade");
      formData.append("teacherId", teacherId);
      formData.append("studentId", studentId);
      formData.append("subject", subject);
      formData.append("score", score);
      formData.append("period", period);

      fetch(scriptUrl, { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("Grade submitted successfully!");
          } else {
            alert("Error: " + data.message);
          }
        })
        .catch(err => console.error(err));
    }

    // On page load
    document.addEventListener("DOMContentLoaded", () => {
      teacherId = localStorage.getItem("teacherId");
      if (!teacherId) {
        alert("Teacher ID missing. Please login again.");
        window.location.href = "teacher_login.html";
        return;
      }
      loadStudents();
    });
  </script>
</body>
</html>
