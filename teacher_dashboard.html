<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teacher Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label, select { font-size: 1rem; margin-top: 10px; }
  #teacherInfo { margin-bottom: 20px; }
  #errorMsg { color: red; margin-top: 10px; }
</style>
</head>
<body>

<h1>Teacher Dashboard</h1>

<div id="teacherInfo">
  <p><strong>Name:</strong> <span id="teacherName">Loading...</span></p>
  <p><strong>ID:</strong> <span id="teacherId">Loading...</span></p>
</div>

<div>
  <label for="studentSelect">Select Assigned Student:</label>
  <select id="studentSelect">
    <option>Loading students...</option>
  </select>
  <div id="errorMsg"></div>
</div>

<script>
  const GAS_URL = "https://script.google.com/macros/s/AKfycbw9P_XOd4k498l0e4WDbFqAF1asb2u4sRj_uX2B-2S1MvyWOeWQZqxy8dr13mPOdNOeuw/exec";

  function displayTeacherInfo() {
    const teacherId = localStorage.getItem("teacherId");
    const teacherName = localStorage.getItem("teacherName") || "Unknown";

    if (!teacherId) {
      document.getElementById("errorMsg").textContent = "Teacher ID missing in localStorage. Please login.";
      document.getElementById("teacherName").textContent = "-";
      document.getElementById("teacherId").textContent = "-";
      return;
    }

    document.getElementById("teacherName").textContent = teacherName;
    document.getElementById("teacherId").textContent = teacherId;

    loadStudents(teacherId);
  }

  function loadStudents(teacherId) {
    const select = document.getElementById("studentSelect");
    const errorDiv = document.getElementById("errorMsg");

    select.innerHTML = '<option>Loading students...</option>';
    errorDiv.textContent = "";

    fetch(`${GAS_URL}?action=getStudentList&role=teacher&teacherId=${encodeURIComponent(teacherId)}`)
      .then(response => {
        if (!response.ok) throw new Error(`Network error: ${response.status}`);
        return response.json();
      })
      .then(data => {
        if (!data.success) throw new Error(data.message);

        if (!data.data || data.data.length === 0) {
          select.innerHTML = '<option>No students assigned</option>';
          return;
        }

        select.innerHTML = '<option value="">-- Select a student --</option>';
        data.data.forEach(student => {
          const option = document.createElement("option");
          option.value = student.StudentID || student.ID || "";
          option.textContent = student.Name || student.FullName || "Unnamed Student";
          select.appendChild(option);
        });
      })
      .catch(err => {
        select.innerHTML = '<option>Error loading students</option>';
        errorDiv.textContent = `Error: ${err.message}`;
        console.error("Error fetching students:", err);
      });
  }

  window.onload = displayTeacherInfo;
</script>

</body>
</html>
