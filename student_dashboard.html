<!DOCTYPE html>
<html>
<head>
  <title>Student Dashboard</title>
  <meta charset="UTF-8">
</head>
<body>
  <h2>Welcome to Your Dashboard</h2>
  <div id="result"></div>
  <button onclick="logout()">Logout</button>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbxD4I6gTNaDa-HgtZQazLP2hZDOa-yEcyt0IBkJNJ008xMu6aDx3Gw0TuY-MgHv83qO/exec";

    // Get StudentID and PIN from localStorage
    const studentId = localStorage.getItem("studentId");
    const pin = localStorage.getItem("pin");

    // Check if user is logged in
    if (!studentId || !pin) {
      alert("Access Denied or Not Logged In");
      window.location.href = "login.html";
    } else {
      // Fetch results
      fetch(apiUrl + "?action=fetchResults&StudentID=" + studentId + "&pin=" + pin)
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            displayResults(data.results);
          } else {
            document.getElementById("result").innerHTML = "Error: " + data.message;
          }
        })
        .catch(error => {
          document.getElementById("result").innerHTML = "Failed to fetch results.";
          console.error(error);
        });
    }

    function displayResults(results) {
      let output = "<h3>Your Results</h3><table border='1' cellpadding='6'><tr>";
      for (let key in results[0]) {
        output += `<th>${key}</th>`;
      }
      output += "</tr>";
      results.forEach(row => {
        output += "<tr>";
        for (let key in row) {
          output += `<td>${row[key]}</td>`;
        }
        output += "</tr>";
      });
      output += "</table>";
      document.getElementById("result").innerHTML = output;
    }

    function logout() {
      localStorage.removeItem("studentId");
      localStorage.removeItem("pin");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
